<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุดุงูุฏุฉ ุงูุจุซ - Ant Media</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body style="text-align: center; padding: 20px;">
    <h1>๐ฅ ูุดุบู ุงูุจุซ - Ant Media</h1>
    
    <div>
        <input type="text" id="streamId" placeholder="Stream ID" value="myStream123">
        <button onclick="startPlayback()">โถ ุชุดุบูู</button>
        <button onclick="stopPlayback()">โน ุฅููุงู</button>
    </div>
    
    <div id="status">๐ฆ ุฌุงูุฒ</div>
    
    <!-- ุงูุฎุทูุฉ ุงูุฌุฏูุฏุฉ: ุฒุฑ ูุญุต ุงูุฑุงุจุท -->
    <div style="margin: 20px;">
        <button onclick="checkStream()">๐ ูุญุต ุงูุจุซ ุนูู ุงูุณูุฑูุฑ</button>
        <div id="checkResult"></div>
    </div>
    
    <video id="videoPlayer" controls width="80%" style="margin-top: 20px;"></video>
    
    <script>
        const SERVER = 'https://ant-media-2kbz.onrender.com';
        const APP = 'live';
        let hls = null;
        
        // ุฏุงูุฉ ุฌุฏูุฏุฉ: ูุญุต ุงูุฑุงุจุท ูุจู ุงูุชุดุบูู
        async function checkStream() {
            const streamId = document.getElementById('streamId').value;
            const url = `${SERVER}/${APP}/streams/${streamId}.m3u8`;
            
            document.getElementById('checkResult').innerHTML = 
                `๐ ุฌุงุฑู ูุญุต ุงูุฑุงุจุท: <br><small>${url}</small><br>โณ ...`;
            
            try {
                const response = await fetch(url, { method: 'HEAD' });
                const resultDiv = document.getElementById('checkResult');
                
                if (response.ok) {
                    resultDiv.innerHTML = 
                        `โ ุงูุฑุงุจุท ููุฌูุฏ ููููู ุงููุตูู ุฅููู! <br>
                         ููููู ุงูุขู ุงูุถุบุท ุนูู "ุชุดุบูู".<br>
                         <small>ุงูุญุงูุฉ: ${response.status} ${response.statusText}</small>`;
                } else {
                    resultDiv.innerHTML = 
                        `โ ุงูุฑุงุจุท ููุฌูุฏ ููู ููุงู ุฎุทุฃ (${response.status}).<br>
                         <strong>ุงูุชูุณูุฑ: ุงูุจุซ ูุฏ ูุง ูููู ูุดุทุงู ุญุงููุงู.</strong><br>
                         ุชุฃูุฏ ูู ุฃู ุงููุฐูุน ูุจุซ ุงูุขู ูุฃู Stream ID ุตุญูุญ.`;
                }
            } catch (error) {
                document.getElementById('checkResult').innerHTML = 
                    `๐ซ <strong>ูุง ูููู ุงููุตูู ุฅูู ุงูุฑุงุจุท!</strong><br>
                     ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:<br>
                     1. ุงูุณูุฑูุฑ ูุชููู (Render.com ูุฌุงูู)<br>
                     2. ุงุณู ุงูู Stream ID ุบูุฑ ุตุญูุญ<br>
                     3. ูุดููุฉ ูู ุงูุดุจูุฉ<br>
                     <small>ุงูุฎุทุฃ: ${error.message}</small>`;
            }
        }
        
        function startPlayback() {
            const streamId = document.getElementById('streamId').value;
            const video = document.getElementById('videoPlayer');
            const url = `${SERVER}/${APP}/streams/${streamId}.m3u8`;
            
            document.getElementById('status').innerHTML = `โ๏ธ ุฌุงุฑู ุงูุชุดุบูู...`;
            
            if (Hls.isSupported()) {
                if (hls) hls.destroy();
                
                hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play();
                    document.getElementById('status').innerHTML = 
                        `โ ุงูุจุซ ููุฏ ุงูุชุดุบูู ุงูุขู`;
                });
                
                hls.on(Hls.Events.ERROR, (event, data) => {
                    console.error('ุฎุทุฃ HLS:', data);
                    
                    if (data.fatal) {
                        let msg = 'โ ุฎุทุฃ ุฌุณูู: ';
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                msg += 'ูุดููุฉ ุดุจูุฉ. ุชุฃูุฏ ุฃู ุงูุจุซ <strong>ูุดุท ุญุงููุงู</strong> ูุฃูู ุชุณุชุฎุฏู ุงูู Stream ID ุงูุตุญูุญ.';
                                // ูุญุงููุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุชููุงุฆูุงู
                                setTimeout(() => hls.loadSource(url), 3000);
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                msg += 'ูุดููุฉ ูู ููู ุงูููุฏูู. ุฌุงุฑู ุงูุฅุตูุงุญ...';
                                hls.recoverMediaError();
                                break;
                            default:
                                msg += 'ูุง ูููู ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู.';
                                hls.destroy();
                        }
                        document.getElementById('status').innerHTML = msg;
                    }
                });
                
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
                video.addEventListener('loadedmetadata', () => {
                    video.play();
                    document.getElementById('status').innerHTML = 'โ ุงูุจุซ ูุนูู (Safari)';
                });
            }
        }
        
        function stopPlayback() {
            if (hls) hls.destroy();
            document.getElementById('videoPlayer').src = '';
            document.getElementById('status').innerHTML = 'โน ูุชููู';
        }
    </script>
</body>
</html>
