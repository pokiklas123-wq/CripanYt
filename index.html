<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± - Ant Media</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        video { width: 100%; max-height: 70vh; background: #000; border-radius: 8px; margin-top: 15px; }
        .controls { margin: 20px 0; }
        input, button { padding: 12px 15px; margin: 5px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
        input { width: 250px; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #status { margin-top: 15px; padding: 10px; border-radius: 5px; }
        .info { background-color: #e7f3ff; color: #004085; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
    <!-- ØªØ¶Ù…ÙŠÙ† Ù…ÙƒØªØ¨Ø© hls.js Ù…Ù† CDN Ù„ØªØ´ØºÙŠÙ„ HLS -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ Ù…Ø´ØºÙ„ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (HLS)</h1>
        <p>Ø£Ø¯Ø®Ù„ <strong>Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø« (Stream ID)</strong> Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ Ø³ÙŠØ±ÙØ± Ant Media.</p>
        
        <div class="controls">
            <input type="text" id="streamIdInput" placeholder="Ù…Ø«Ø§Ù„: stream1" value="stream1">
            <button onclick="loadStream()">â–¶ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø«</button>
            <button onclick="stopStream()">â¹ Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
        
        <div id="status" class="info">Ø¬Ø§Ù‡Ø². Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø« ÙˆØ§Ø¶ØºØ· ØªØ´ØºÙŠÙ„.</div>
        
        <video id="videoPlayer" controls autoplay playsinline></video>
        
        <div style="margin-top: 20px; text-align: left; background: #f8f9fa; padding: 15px; border-radius: 5px;">
            <h3>ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†:</h3>
            <p>Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«ØŒ Ø´Ø§Ø±Ùƒ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ HLS Ø§Ù„ØªØ§Ù„ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†:</p>
            <code id="hlsUrlDisplay" style="display: block; word-break: break-all; padding: 10px; background: #eee; margin: 10px 0;">...</code>
            <p><small>ÙŠÙ…ÙƒÙ† ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø£ÙŠ Ù…Ø´ØºÙ„ ÙŠØ¯Ø¹Ù… HLS (Ù…Ø«Ù„ VLC) Ø£Ùˆ ØªØ¶Ù…ÙŠÙ†Ù‡ ÙÙŠ ØµÙØ­Ø§Øª ÙˆÙŠØ¨ Ø£Ø®Ø±Ù‰.</small></p>
        </div>
    </div>

    <script>
        // ğŸ”§ 1. Ø¶Ø¹ Ù‡Ù†Ø§ Ø¹Ù†ÙˆØ§Ù† Ø³ÙŠØ±ÙØ±Ùƒ ANT MEDIA
        // Ø§Ø³ØªØ¨Ø¯Ù„ ant-media-2kbz.onrender.com Ø¨Ø¹Ù†ÙˆØ§Ù† Ø³ÙŠØ±ÙØ±Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ
        const ANT_MEDIA_SERVER_BASE = "https://ant-media-2kbz.onrender.com";
        const ANT_MEDIA_APP_NAME = "live"; // Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ø§Ø¯Ø©Ù‹ Ù‡Ùˆ "live"
        
        let hlsPlayer = null; // ÙƒØ§Ø¦Ù† Hls
        
        function loadStream() {
            const streamId = document.getElementById('streamIdInput').value.trim();
            const statusDiv = document.getElementById('status');
            const video = document.getElementById('videoPlayer');
            
            if (!streamId) {
                statusDiv.textContent = "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø«.";
                statusDiv.className = "error";
                return;
            }
            
            // ğŸ”— 2. Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ù€ M3U8 (HLS)
            // Ø§Ù„ØµÙŠØºØ©: https://[server]/[app-name]/streams/[streamId].m3u8
            const hlsUrl = `${ANT_MEDIA_SERVER_BASE}/${ANT_MEDIA_APP_NAME}/streams/${streamId}.m3u8`;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
            document.getElementById('hlsUrlDisplay').textContent = hlsUrl;
            
            statusDiv.textContent = `âš™ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«: ${streamId}...`;
            statusDiv.className = "info";
            
            // 3. Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø¨Ø« Ø³Ø§Ø¨Ù‚
            if (hlsPlayer) {
                hlsPlayer.destroy();
                hlsPlayer = null;
            }
            
            // 4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø«
            if (Hls.isSupported()) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… hls.js Ù„Ù„Ù…ØªØµÙØ­Ø§Øª ØºÙŠØ± Ø§Ù„Ø³ÙØ§Ø±ÙŠ
                hlsPlayer = new Hls({
                    enableWorker: false // Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø¶Ø±ÙˆØ±ÙŠØ§Ù‹ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ¦Ø§Øª
                });
                hlsPlayer.loadSource(hlsUrl);
                hlsPlayer.attachMedia(video);
                
                hlsPlayer.on(Hls.Events.MANIFEST_PARSED, function() {
                    statusDiv.textContent = `âœ… Ø§Ù„Ø¨Ø« Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù†: ${streamId}`;
                    statusDiv.className = "info";
                    video.play().catch(e => {
                        statusDiv.textContent = "âš ï¸ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø­Ø¸ÙˆØ±. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.";
                    });
                });
                
                hlsPlayer.on(Hls.Events.ERROR, function(event, data) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ HLS:", data);
                    if (data.fatal) {
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                statusDiv.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨Ø« Ù†Ø´Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±.";
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                statusDiv.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.";
                                hlsPlayer.recoverMediaError();
                                break;
                            default:
                                statusDiv.textContent = "âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«.";
                                hlsPlayer.destroy();
                        }
                        statusDiv.className = "error";
                    }
                });
                
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ ØªØ¯Ø¹Ù… HLS natively (Ù…Ø«Ù„ Safari Ø¹Ù„Ù‰ iOS/Mac)
                video.src = hlsUrl;
                video.addEventListener('loadedmetadata', function() {
                    statusDiv.textContent = `âœ… Ø§Ù„Ø¨Ø« Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ (Safari): ${streamId}`;
                    statusDiv.className = "info";
                    video.play();
                });
            } else {
                statusDiv.textContent = "âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ HLS.";
                statusDiv.className = "error";
            }
        }
        
        function stopStream() {
            const statusDiv = document.getElementById('status');
            const video = document.getElementById('videoPlayer');
            
            if (hlsPlayer) {
                hlsPlayer.destroy();
                hlsPlayer = null;
            }
            video.src = "";
            statusDiv.textContent = "â¹ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«.";
            statusDiv.className = "info";
            document.getElementById('hlsUrlDisplay').textContent = "...";
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ø±Ù Ø§ÙØªØ±Ø§Ø¶ÙŠ
        window.onload = function() {
            if(document.getElementById('streamIdInput').value) {
                //loadStream(); // ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            }
        };
    </script>
</body>
</html>
