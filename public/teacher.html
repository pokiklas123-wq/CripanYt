<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        body { margin: 0; padding: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: auto; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        .main-content { display: flex; gap: 20px; flex-wrap: wrap; }
        .video-section { flex: 2; min-width: 300px; }
        .control-section { flex: 1; min-width: 300px; }
        .video-container {
            background: #000; border-radius: 10px; overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        video { width: 100%; height: auto; max-height: 400px; }
        .controls { background: white; padding: 20px; border-radius: 10px; margin-top: 20px; }
        .btn {
            display: block; width: 100%; padding: 15px; margin: 10px 0;
            border: none; border-radius: 8px; font-size: 16px;
            cursor: pointer; transition: all 0.3s;
        }
        .btn-start { background: #27ae60; color: white; }
        .btn-stop { background: #e74c3c; color: white; }
        .btn-share { background: #3498db; color: white; }
        .btn:disabled { background: #95a5a6; cursor: not-allowed; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.2); }
        .status {
            padding: 15px; border-radius: 8px; text-align: center;
            margin: 20px 0; font-weight: bold;
        }
        .status-active { background: #d4efdf; color: #27ae60; border: 2px solid #27ae60; }
        .status-inactive { background: #fadbd8; color: #e74c3c; border: 2px solid #e74c3c; }
        .url-box {
            background: #ebf5fb; padding: 20px; border-radius: 10px;
            margin: 20px 0; display: none;
        }
        .url-box input {
            width: 100%; padding: 10px; margin: 10px 0;
            border: 2px solid #3498db; border-radius: 5px;
            font-size: 14px;
        }
        .copy-btn {
            background: #2980b9; color: white; padding: 10px 20px;
            border: none; border-radius: 5px; cursor: pointer;
        }
        .stats {
            display: flex; justify-content: space-around;
            background: white; padding: 15px; border-radius: 10px;
            margin: 20px 0;
        }
        .stat-item { text-align: center; }
        .stat-number { font-size: 24px; font-weight: bold; color: #2c3e50; }
        .stat-label { color: #7f8c8d; font-size: 14px; }
        @media (max-width: 768px) {
            .main-content { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯Ø±Ø³ - Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h1>
        
        <div class="status status-inactive" id="status">
            âš« Ø§Ù„Ø¨Ø« ØºÙŠØ± Ù†Ø´Ø· - Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
        </div>
        
        <div class="main-content">
            <div class="video-section">
                <div class="video-container">
                    <video id="localVideo" autoplay muted></video>
                </div>
                
                <div class="controls">
                    <button onclick="startBroadcast()" id="startBtn" class="btn btn-start">
                        â–¶ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                    </button>
                    <button onclick="stopBroadcast()" id="stopBtn" class="btn btn-stop" disabled>
                        â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«
                    </button>
                    <button onclick="toggleScreenShare()" id="screenBtn" class="btn btn-share">
                        ğŸ–¥ï¸ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©
                    </button>
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="viewerCount">0</div>
                        <div class="stat-label">ğŸ‘¥ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="duration">00:00</div>
                        <div class="stat-label">â±ï¸ Ø§Ù„Ù…Ø¯Ø©</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="fps">0</div>
                        <div class="stat-label">ğŸ“Š FPS</div>
                    </div>
                </div>
            </div>
            
            <div class="control-section">
                <div class="url-box" id="urlBox">
                    <h3>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø« Ù„Ù„Ø·Ù„Ø§Ø¨:</h3>
                    <input type="text" id="broadcastUrl" readonly>
                    <button onclick="copyUrl()" class="copy-btn">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
                    <p style="color: #7f8c8d; margin-top: 10px; font-size: 14px;">
                        Ø£Ø±Ø³Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø·Ù„Ø§Ø¨ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                    </p>
                </div>
                
                <div style="background: #fff8e1; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h3 style="color: #ff9800; margin-top: 0;">ğŸ¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:</h3>
                    <ol style="padding-right: 20px; color: #5d4037;">
                        <li>Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«" ÙˆØ³ÙŠØ·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†</li>
                        <li>Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø±</li>
                        <li>Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø·Ù„Ø§Ø¨</li>
                        <li>Ø§Ø¶ØºØ· "Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©" Ù„Ø¹Ø±Ø¶ Ø´Ø§Ø´ØªÙƒ</li>
                        <li>ØªØ­Ø¯Ø« Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ - Ø§Ù„Ø·Ù„Ø§Ø¨ Ø³ÙŠØ´Ø§Ù‡Ø¯ÙˆÙ†</li>
                    </ol>
                </div>
                
                <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h3 style="color: #4CAF50; margin-top: 0;">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©:</h3>
                    <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> <span id="siteUrl">https://cripanyt.onrender.com</span></p>
                    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span id="connectionStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></p>
                    <p><strong>Ø§Ù„Ø¯Ø¹Ù…:</strong> Chrome, Firefox, Edge (ÙŠØ­ØªØ§Ø¬ HTTPS)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let localStream;
        let ws;
        let broadcastId;
        let isBroadcasting = false;
        let isScreenSharing = false;
        let viewerCount = 0;
        let broadcastStartTime;
        let frameCount = 0;
        let fpsInterval;
        
        // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        const SERVER_URL = window.location.origin;
        
        // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹
        document.getElementById('siteUrl').textContent = SERVER_URL;
        
        async function startBroadcast() {
            try {
                // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        frameRate: { ideal: 15 }
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });
                
                // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ù„ÙŠ
                const videoElement = document.getElementById('localVideo');
                videoElement.srcObject = localStream;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø§Ù„Ø¨Ø«
                broadcastId = 'class_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
                
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… WebSocket
                ws = new WebSocket(SERVER_URL.replace('http', 'ws'));
                
                ws.onopen = () => {
                    console.log('âœ… Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                    
                    // ØªØ³Ø¬ÙŠÙ„ ÙƒÙ…Ø¯Ø±Ø³
                    ws.send(JSON.stringify({
                        type: 'register_teacher',
                        broadcastId: broadcastId,
                        title: 'Ø¨Ø« ØªØ¹Ù„ÙŠÙ…ÙŠ Ù…Ø¨Ø§Ø´Ø±'
                    }));
                    
                    // Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                    startVideoStreaming();
                    
                    // Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª
                    startAudioStreaming();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                    isBroadcasting = true;
                    broadcastStartTime = Date.now();
                    updateDuration();
                    
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('status').className = 'status status-active';
                    document.getElementById('status').innerHTML = 'ğŸŸ¢ Ø§Ù„Ø¨Ø« Ù†Ø´Ø· - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
                    
                    document.getElementById('connectionStatus').textContent = 'ğŸŸ¢ Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…';
                    
                    console.log('ğŸ¬ Ø§Ù„Ø¨Ø« Ø¨Ø¯Ø£:', broadcastId);
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'teacher_registered') {
                        // Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«
                        const urlInput = document.getElementById('broadcastUrl');
                        urlInput.value = data.url;
                        document.getElementById('urlBox').style.display = 'block';
                        
                        // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                        copyUrl();
                        
                    } else if (data.type === 'chat_message') {
                        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
                        console.log('ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø©:', data.message);
                    }
                };
                
                ws.onerror = (error) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ WebSocket:', error);
                    document.getElementById('connectionStatus').textContent = 'ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
                    alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                };
                
                ws.onclose = () => {
                    console.log('ğŸ”Œ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„');
                    if (isBroadcasting) {
                        alert('âš ï¸ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©...');
                        setTimeout(() => location.reload(), 2000);
                    }
                };
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«:', error);
                alert('âŒ Ø®Ø·Ø£: ' + error.message + 
                    '\n\nØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†\n2. Ø§Ø³ØªØ®Ø¯Ø§Ù… HTTPS\n3. Ø§ØªØµØ§Ù„ Ø¥Ù†ØªØ±Ù†Øª Ø¬ÙŠØ¯');
            }
        }
        
        function startVideoStreaming() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const video = document.getElementById('localVideo');
            
            canvas.width = 640;
            canvas.height = 360;
            
            let lastFrameTime = Date.now();
            
            function captureFrame() {
                if (!isBroadcasting) return;
                
                const now = Date.now();
                const elapsed = now - lastFrameTime;
                
                if (elapsed >= 100) { // 10 ÙØ±ÙŠÙ…Ø§Øª ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    canvas.toBlob((blob) => {
                        if (!blob) return;
                        
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ±ÙŠÙ… Ù„Ù„Ø®Ø§Ø¯Ù…
                            fetch(SERVER_URL + '/api/stream', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    frame: reader.result,
                                    broadcastId: broadcastId
                                })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    document.getElementById('viewerCount').textContent = data.viewers;
                                    viewerCount = data.viewers;
                                }
                            })
                            .catch(error => console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ±ÙŠÙ…:', error));
                        };
                        reader.readAsDataURL(blob);
                    }, 'image/jpeg', 0.7);
                    
                    frameCount++;
                    lastFrameTime = now;
                }
                
                requestAnimationFrame(captureFrame);
            }
            
            // Ø¨Ø¯Ø¡ Ø­Ø³Ø§Ø¨ FPS
            if (fpsInterval) clearInterval(fpsInterval);
            fpsInterval = setInterval(() => {
                document.getElementById('fps').textContent = frameCount;
                frameCount = 0;
            }, 1000);
            
            captureFrame();
        }
        
        function startAudioStreaming() {
            if (!localStream.getAudioTracks().length) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const source = audioContext.createMediaStreamSource(localStream);
            const processor = audioContext.createScriptProcessor(1024, 1, 1);
            
            source.connect(processor);
            processor.connect(audioContext.destination);
            
            processor.onaudioprocess = (e) => {
                if (!isBroadcasting || !ws || ws.readyState !== WebSocket.OPEN) return;
                
                const inputData = e.inputBuffer.getChannelData(0);
                const buffer = new Float32Array(inputData.length);
                
                for (let i = 0; i < inputData.length; i++) {
                    buffer[i] = inputData[i];
                }
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¬Ø²Ø¡ Ø§Ù„ØµÙˆØª
                ws.send(JSON.stringify({
                    type: 'audio_chunk',
                    chunk: Array.from(buffer),
                    broadcastId: broadcastId
                }));
            };
        }
        
        async function toggleScreenShare() {
            try {
                if (isScreenSharing) {
                    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: true
                    });
                    
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = stream;
                    document.getElementById('localVideo').srcObject = localStream;
                    isScreenSharing = false;
                    document.getElementById('screenBtn').textContent = 'ğŸ–¥ï¸ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©';
                    
                } else {
                    // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©
                    const stream = await navigator.mediaDevices.getDisplayMedia({
                        video: { frameRate: 15 },
                        audio: true
                    });
                    
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = stream;
                    document.getElementById('localVideo').srcObject = localStream;
                    isScreenSharing = true;
                    document.getElementById('screenBtn').textContent = 'ğŸ“· Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
                    
                    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†Ø¹ Ø¹Ù†Ø¯ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©
                    stream.getVideoTracks()[0].onended = () => {
                        if (isScreenSharing) {
                            toggleScreenShare();
                        }
                    };
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©:', error);
                if (error.name !== 'NotAllowedError') {
                    alert('âŒ Ø®Ø·Ø£: ' + error.message);
                }
            }
        }
        
        function stopBroadcast() {
            isBroadcasting = false;
            
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.close();
            }
            
            if (fpsInterval) {
                clearInterval(fpsInterval);
            }
            
            document.getElementById('status').className = 'status status-inactive';
            document.getElementById('status').innerHTML = 'âš« Ø§Ù„Ø¨Ø« Ù…ØªÙˆÙ‚Ù';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('localVideo').srcObject = null;
            document.getElementById('urlBox').style.display = 'none';
            document.getElementById('viewerCount').textContent = '0';
            document.getElementById('fps').textContent = '0';
            document.getElementById('duration').textContent = '00:00';
            
            console.log('â¹ï¸ Ø§Ù„Ø¨Ø« ØªÙˆÙ‚Ù');
        }
        
        function copyUrl() {
            const urlInput = document.getElementById('broadcastUrl');
            urlInput.select();
            urlInput.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(urlInput.value).then(() => {
                alert('âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«!\n\nØ§Ù„Ø±Ø§Ø¨Ø·: ' + urlInput.value + '\n\nØ£Ø±Ø³Ù„Ù‡ Ø§Ù„Ø¢Ù† Ù„Ù„Ø·Ù„Ø§Ø¨.');
            }).catch(err => {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', err);
            });
        }
        
        function updateDuration() {
            if (!broadcastStartTime) return;
            
            setInterval(() => {
                if (isBroadcasting) {
                    const now = Date.now();
                    const diff = Math.floor((now - broadcastStartTime) / 1000);
                    const minutes = Math.floor(diff / 60);
                    const seconds = diff % 60;
                    
                    document.getElementById('duration').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…
        async function checkServerConnection() {
            try {
                const response = await fetch(SERVER_URL + '/health');
                const data = await response.json();
                document.getElementById('connectionStatus').textContent = 'ğŸŸ¢ Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„';
                console.log('âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…:', data);
            } catch (error) {
                document.getElementById('connectionStatus').textContent = 'ğŸ”´ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„';
                console.error('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…:', error);
            }
        }
        
        // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = () => {
            checkServerConnection();
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ø« Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©
            window.addEventListener('beforeunload', (event) => {
                if (isBroadcasting) {
                    event.preventDefault();
                    event.returnValue = 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¨Ø« ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ØŸ';
                    stopBroadcast();
                }
            });
        };
    </script>
</body>
  </html>
